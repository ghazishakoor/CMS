{% extends 'cmsmain/base.html' %}

{% load static %}
{% block content %}


<h3 class="mt-2 text-center">Add Exam Mark</h3>
<hr />

<div class="d-flex justify-content-center">
    <div class="row">
        <div class="col col-md">
            <div class="card bg-light">
                <div class="card-header">
                    <strong>Exam Marks Form</strong>
                </div>
                <div class="card-body shadow-lg rounded">
                    <h6><strong> This form will override any previous values </strong></h6>
                    <hr />

                    <form method="post">
                        {% csrf_token %}
                        
                        <!-- Select Exam -->
                        <label for="id_exam">Select Exam:</label>
                        <select name="exam" id="id_exam">
                            {% for exam in exams %}
                            <option value="{{ exam.id }}">{{ exam.name }}</option>
                            {% endfor %}
                        </select>
                        <br />
                        <br />
                        
                        <!-- Table to display students and marks -->
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Student</th>
                                    <th>Mark</th>
                                    <th>Remark</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for student in students %}
                                <tr>
                                    <td>{{ student.full_name }}</td>
                                    <td><input type="number" step="0.01" name="marks_{{ student.id }}" value=""></td>
                                    <td><input type="text" name="remarks_{{ student.id }}" value=""></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        
                        <button type="submit" class="btn btn-primary">Save</button>
                        <a class="btn btn-secondary" href="{{ request.META.HTTP_REFERER }}">Cancel</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

  // Fetch students for the selected exam
  document.addEventListener('DOMContentLoaded', function() {
    var selectedExamId = document.getElementById('id_exam').value;
    fetchStudents(selectedExamId);

    document.getElementById('id_exam').addEventListener('change', function() {
      var selectedExamId = this.value;
      fetchStudents(selectedExamId);
    });

    function fetchStudents(examId) {
      if (examId) {
        fetch('/fetch_students/?exam_id=' + examId)
          .then(response => response.json())
          .then(data => {
            var studentTableBody = document.querySelector('tbody');
            studentTableBody.innerHTML = ''; // Clear existing rows
            data.forEach(student => {
              var row = document.createElement('tr');
              row.innerHTML = `
                <td>${student.full_name}</td>
                <td><input type="number" step="0.01" name="marks_${student.id}" value=""></td>
                <td><input type="text" name="remarks_${student.id}" value=""></td>
              `;
              studentTableBody.appendChild(row);
            });
          });
      }
    }
  });
</script>


{% endblock %}